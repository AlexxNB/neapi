{"version":3,"file":"bundle.js","sources":["../../client/index.js","../client-src/main.js"],"sourcesContent":["\nconst client = function (user_config) {\n\n    const default_config = {\n        endpoint: '/api',\n        onRequest: async () => {},\n        onResponce: async () => {}\n    }\n\n    const config = Object.assign({}, default_config, user_config);\n\n    return {\n        request:request(config),\n    }\n\n}\n\n\nconst request = (config) => async (namespace,method,params,context_obj) => {\n    \n    const context = object_manager(context_obj || {});\n    const packet = getPacket();\n    \n    packet.namespace = namespace;\n    packet.method = method || 'unknown';\n    packet.params = params || {};\n\n    await config.onRequest({\n        namespace:packet.namespace,\n        method:packet.method,\n        params:packet.params\n    },context);\n\n    packet.context = context();\n\n    let raw_responce = await fetch(config.endpoint,{ \n        method: 'POST',\n        headers: {  \n            \"Content-type\": \"application/json; charset=UTF-8\"\n        }, \n        credentials: 'include',  \n        body: JSON.stringify(packet)\n    });\n\n    if(raw_responce.status !== 200) throw new Error('[NeAPI] Bad answer from server');\n\n    let responce = await raw_responce.json();\n\n    if(!responce_validator(responce)) throw new Error('[NeAPI] Invalid responce packet');\n    \n    let rcv_context = object_manager(responce.context);\n\n    await config.onResponce({\n        namespace:responce.namespace,\n        method:responce.method,\n        payload:responce.payload,\n        error:responce.error,\n    },rcv_context);\n\n    return {\n        error:  responce.error,\n        payload:responce.payload,\n        context:rcv_context\n    };\n}\n\n\nconst object_manager = (obj) => (propname,value) => {\n    if(propname === undefined && value === undefined)\n        return obj;\n    else if (typeof propname === 'object') \n        obj = Object.assign(obj, propname);\n    else if(value === undefined)\n        return obj[propname];\n    else\n        obj[propname] = value;\n}\n\nconst getPacket = function () {\n    return {\n        namespace:'',\n        method:'',\n        params:{},\n        context:{}\n    }\n}\n\nconst responce_validator = function (responce) {\n    if(!responce.namespace) return false;\n    if(!responce.method) return false;\n    if(responce.error === undefined) return false;\n    if(responce.payload === undefined) return false;\n    if(responce.context === undefined) return false;\n    return true;\n}\n\nexport default {\n    client\n}","import neapi from './../../client';\n\nconst api = neapi.client({\n    endpoint: '/api',\n    onRequest: (packet,context) => {\n        console.log('NeAPI Request:', packet);\n        console.log('NeAPI Request Context:', context());\n    },\n    onResponce: (packet,context) => {\n        console.log('NeAPI Responce:', packet);\n        console.log('NeAPI Responce Context:', context());\n    }\n})\n\n\n\nexport function doCountAddition() {\n    const a = Number(document.getElementById('ex1_a').value);\n    const b = Number(document.getElementById('ex1_b').value);\n\n    api.request('algebra','addition',{a,b}).then((responce)=>{\n        if(responce.error){\n            alert(\"We have an error!\");\n        }else{\n            alert(\"The sum is equal \"+responce.payload);\n        }\n    })\n}\n\nexport function doLogin() {\n    const login = document.getElementById('ex2_login').value;\n    const password = document.getElementById('ex2_password').value;\n\n    neapi.request('auth','get_token',{login,password}).then((responce)=>{\n        if(responce.error){\n            alert(\"We have an error!\");\n        }\n\n        // we will save token in onResponce hook\n    })\n}\n\n"],"names":[],"mappings":"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"}