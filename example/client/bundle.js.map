{"version":3,"file":"bundle.js","sources":["../../share/utils.js","../../client/index.js","../client-src/main.js"],"sourcesContent":["(function(exports){\n\n    const object_manager = (obj) => {\n        return {\n            get:(propname) => propname === undefined ? obj : obj[propname],\n            set:(propname,value) => obj[propname] = value,\n            clear:(propname) => propname === undefined ? Object.keys(obj).forEach(key=>delete obj[key]) : delete obj[propname],\n            merge:(part) => obj = Object.assign(obj, part),\n        }\n    }\n\n   exports.object_manager = object_manager\n\n})(typeof exports === 'undefined'? this['utils']={}: exports);","import utils from './../share/utils'\n\nconst object_manager = utils.object_manager;\n\nconst client = function (user_config) {\n\n    const default_config = {\n        endpoint: '/api',\n        onRequest: async () => {},\n        onResponce: async () => {}\n    }\n\n    const config = Object.assign({}, default_config, user_config);\n\n    return {\n        request:request(config),\n    }\n\n}\n\n\nconst request = (config) => async (namespace,method,params,context_cb) => {\n    \n    const context = object_manager({});\n    if(typeof context_cb === 'function') context_cb(context);\n\n    const packet = getPacket();\n    \n    packet.namespace = namespace;\n    packet.method = method || 'unknown';\n    packet.params = params || {};\n\n    await config.onRequest({\n        namespace:packet.namespace,\n        method:packet.method,\n        params:packet.params\n    },context);\n\n    packet.context = context.get();\n\n    let raw_responce = await fetch(config.endpoint,{ \n        method: 'POST',\n        headers: {  \n            \"Content-type\": \"application/json; charset=UTF-8\"\n        }, \n        credentials: 'include',  \n        body: JSON.stringify(packet)\n    });\n\n    if(raw_responce.status !== 200) throw new Error('[NeAPI] Bad answer from server');\n\n    let responce = await raw_responce.json();\n\n    if(!responce_validator(responce)) throw new Error('[NeAPI] Invalid responce packet');\n    \n    let rcv_context = object_manager(responce.context);\n\n    await config.onResponce({\n        namespace:responce.namespace,\n        method:responce.method,\n        payload:responce.payload,\n        error:responce.error,\n    },rcv_context);\n\n    return {\n        error:  responce.error,\n        payload:responce.payload,\n        context:rcv_context\n    };\n}\n\nconst getPacket = function () {\n    return {\n        namespace:'',\n        method:'',\n        params:{},\n        context:{}\n    }\n}\n\nconst responce_validator = function (responce) {\n    if(!responce.namespace) return false;\n    if(!responce.method) return false;\n    if(responce.error === undefined) return false;\n    if(responce.payload === undefined) return false;\n    if(responce.context === undefined) return false;\n    return true;\n}\n\nexport default {\n    client\n}","import neapi from './../../client';\n\nconst api = neapi.client({\n    endpoint: '/api',\n    onRequest: (packet,context) => {\n        console.log('NeAPI Request:', packet);\n        console.log('NeAPI Request Context:', context.get());\n    },\n    onResponce: (packet,context) => {\n        console.log('NeAPI Responce:', packet);\n        console.log('NeAPI Responce Context:', context.get());\n    }\n})\n\n\n\nexport function doCountAddition() {\n    const a = Number(document.getElementById('ex1_a').value);\n    const b = Number(document.getElementById('ex1_b').value);\n\n    api.request('algebra','addition',{a,b},c=>c.set('test',true)).then((responce)=>{\n        if(responce.error){\n            alert(\"We have an error!\");\n        }else{\n            alert(\"The sum is equal \"+responce.payload);\n        }\n    })\n}\n\nexport function doLogin() {\n    const login = document.getElementById('ex2_login').value;\n    const password = document.getElementById('ex2_password').value;\n\n    neapi.request('auth','get_token',{login,password}).then((responce)=>{\n        if(responce.error){\n            alert(\"We have an error!\");\n        }\n\n        // we will save token in onResponce hook\n    })\n}\n\n"],"names":[],"mappings":"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"}